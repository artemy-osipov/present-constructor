<h1 class="title">Новый подарок</h1>

<div *ngIf="successAdd" class="notification is-primary">Добавлено</div>

<form [formGroup]="form" (ngSubmit)="onSubmit()">
  <div class="field">
    <label class="label">Название</label>
    <div class="control">
      <input class="input" formControlName="name" appFormControl />
    </div>
  </div>
  <div class="field">
    <label class="label">Цена</label>
    <div class="control">
      <input
        class="input"
        type="number"
        placeholder="Пример: 123.12"
        formControlName="price"
        appFormControl
      />
    </div>
  </div>
  <div class="field">
    <div class="control">
      <button type="submit" class="button is-primary">
        <span class="icon">
          <fa-icon icon="plus"></fa-icon>
        </span>
        <span>Добавить</span>
      </button>
    </div>
  </div>
  <div #costField class="field">
    <label class="label">Себестоимость</label>
    <div class="control">
      {{ present.cost | price }}
    </div>
  </div>
  <div class="field">
    <label class="label">Состав</label>

    <mat-expansion-panel
      formArrayName="items"
      appFormControl
      [disabled]="itemsForm.controls.length === 0"
    >
      <mat-expansion-panel-header>
        <mat-panel-title>
          Позиций: {{ itemsForm.controls.length }}
        </mat-panel-title>
      </mat-expansion-panel-header>
      <table class="is-hidden-mobile table is-fullwidth">
        <tbody>
          <tr>
            <th>Название</th>
            <th>Производитель</th>
            <th>Цена</th>
            <th>Кол-во</th>
          </tr>

          <tr *ngFor="let item of itemsForm.controls">
            <td>{{ item.value.candy.name }}</td>
            <td>{{ item.value.candy.firm }}</td>
            <td>{{ item.value.candy.price | price }}</td>
            <td>
              <app-present-item-control
                [currentCount]="item.value.count"
                (newCount)="
                  onItemCountChange({ candy: item.value.candy, count: $event })
                "
              ></app-present-item-control>
            </td>
          </tr>
        </tbody>
      </table>
      <div class="is-hidden-tablet columns is-multiline">
        <div class="column" *ngFor="let item of itemsForm.controls">
          <div class="card">
            <header class="card-header">
              <div class="card-header-title">{{ item.value.candy.name }}</div>
            </header>
            <div class="card-content">
              <div class="content">
                <div>
                  <strong>Производитель: </strong>{{ item.value.candy.firm }}
                </div>
                <div>
                  <strong>Цена: </strong>{{ item.value.candy.price | price }}
                </div>
              </div>
            </div>
            <footer class="card-footer">
              <app-present-item-control
                class="card-footer-item"
                [currentCount]="item.value.count"
                (newCount)="
                  onItemCountChange({ candy: item.value.candy, count: $event })
                "
              ></app-present-item-control>
            </footer>
          </div>
        </div>
      </div>
    </mat-expansion-panel>
  </div>
</form>

<app-present-new-select-candy
  [selectedItems]="selectedItems"
  (changedCount)="onItemCountChange($event)"
></app-present-new-select-candy>

<app-scroll-nav
  [message]="'Себестоимость: ' + (present.cost | price)"
  [scrollElement]="costField"
></app-scroll-nav>
